import abc
import typing

from ib_users.constants.otp_verification_constants import VerificationType, \
    SendOTPThrough
from ib_users.interactors.storages.user_accounts_storage import PhoneNumberDTO
from ib_users.interactors.verify_through_otp_interface import \
    VerifyThroughOTPInterface


class OTPService:
    __metaclass__ = abc.ABCMeta

    def __init__(self, verify_otp_interactor: VerifyThroughOTPInterface):
        self.verify_otp_interactor = verify_otp_interactor

    @abc.abstractmethod
    def validate_otp_send_to_phone_number(self,
                                          phone_number_dto: PhoneNumberDTO,
                                          otp: str):
        pass

    def validate_otp_send_to_email(self,
                                   email: str,
                                   otp: str):
        pass

    @abc.abstractmethod
    def send_otp_to_user(self,email: str,
                         phone_number: PhoneNumberDTO,
                         template: str,subject:str):
        pass

    @abc.abstractmethod
    def send_otp_to_user_email(self,  email: str, template: str, subject:str):
        pass

    @abc.abstractmethod
    def send_otp_to_user_phone_number(self,
                                      phone_number: PhoneNumberDTO,
                                      template: str,
                                      call_template: typing.Optional[str],
                                      send_otp_through: SendOTPThrough):
        pass

    @abc.abstractmethod
    def validate_otp_send_to_recovery_phone_number(self,
                                                   phone_number_dto: PhoneNumberDTO,
                                                   otp: str,
                                                   user_id: str):
        pass

    @abc.abstractmethod
    def validate_otp_send_to_recovery_email(self,
                                            email: str,
                                            otp: str,
                                            user_id: str):
        pass
