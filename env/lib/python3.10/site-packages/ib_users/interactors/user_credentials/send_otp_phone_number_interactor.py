from ib_users.constants.otp_verification_constants import SendOTPThrough
from ib_users.interactors.DTOs.common_dtos import PhoneNumberDTO
from ib_users.interactors.storages import UserAccountsStorage
from ib_users.interactors.third_party.otp_service import OTPService
from ib_users.interactors.validators.phone_number_validator import \
    PhoneNumberValidator


class SendOTPPhoneNumberInteractor:
    def __init__(self, storage: UserAccountsStorage,
                 otp_service: OTPService,
                 phone_numbers_validator: PhoneNumberValidator):
        self.storage = storage
        self.otp_service = otp_service
        self.phone_numbers_validator = phone_numbers_validator

    def send_otp_to_phone_number(self, phone_number_dto: PhoneNumberDTO):
        self.phone_numbers_validator.validate(phone_number_dto)
        self.storage.get_user_given_phone_number(phone_number_dto)
        from ib_users.constants.otp_constants import OTPMessageFormatConstants
        self.otp_service.send_otp_to_user_phone_number(
            phone_number=phone_number_dto,
            template=OTPMessageFormatConstants.FORMAT_TO_RESET_PASSWORD,
            send_otp_through=SendOTPThrough.SMS,
            call_template=None
        )
