from ib_users.interactors.presenters.registration_presenter import \
    RegistrationPresenter
from ib_users.interactors.storages.user_social_accounts_storage import \
    UserSocialAccountsStorage
from ib_users.interactors.third_party.social_account import SocialAccount


class SocialRegistrationInteractor:
    def __init__(self, accounts_storage: UserSocialAccountsStorage,
                 presenter: RegistrationPresenter,
                 social_sdk: SocialAccount):
        self.social_account_storage = accounts_storage
        self.presenter = presenter
        self.social_sdk = social_sdk

    def create_account_with_social_details(
            self, social_provider: str, **kwargs):

        social_id = self.social_sdk.get_social_id(**kwargs)

        self.social_account_storage.check_social_details_is_registered(
            social_id=social_id, social_provider=social_provider)

        user_id = self.social_account_storage. \
            create_account_with_social_details(social_id=social_id,
                                               social_provider=social_provider)

        return self.presenter.get_user_id(user_id)
