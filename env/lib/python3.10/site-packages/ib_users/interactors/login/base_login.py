import abc
import typing

from ib_users.exceptions.custom_exception_constants import \
    USER_ACCOUNT_IS_DEACTIVATED
from ib_users.validators.base_validator import CustomException


class BaseLogin:
    __metaclass__ = abc.ABCMeta

    def __init__(self, storage):
        self.storage = storage

    @abc.abstractmethod
    def get_user_id_for_given_login_data(
            self, login_dto, device_id: typing.Optional[str]):
        pass

    def validate_user_account_for_active_state(self, user_id):
        if not self.storage.is_user_account_active(user_id):
            raise CustomException.from_exception_message_DTO(
                USER_ACCOUNT_IS_DEACTIVATED
            )
