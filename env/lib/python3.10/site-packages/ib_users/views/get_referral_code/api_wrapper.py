from django_swagger_utils.drf_server.utils.decorator.interface_decorator \
    import validate_decorator
from .validator_class import ValidatorClass


@validate_decorator(validator_class=ValidatorClass)
def api_wrapper(*args, **kwargs):
    request_data = kwargs['request_data']
    user_id = request_data['user_id']

    from ib_users.interactors.referrals_interactor import ReferralsInteractor
    from ib_users.storages.referrals_storage_impl import ReferralsSQLStorage
    from ib_users.presenters.referrals_presenter_impl import \
        ReferralsPresenterJSON

    storage = ReferralsSQLStorage()
    presenter = ReferralsPresenterJSON()
    interactor = ReferralsInteractor(storage=storage, presenter=presenter)

    referral_code = interactor.get_or_create_referral_code(user_id=user_id)

    return {
        "referral_code": referral_code
    }
